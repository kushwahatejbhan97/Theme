(function($){'use strict';var $body=$('body');var xhr=false;function quick_product_variable(){var btnSelector='.products .product-type-variable .add_to_cart_button, .products-list .product-type-variable .add_to_cart_button';var xhr=false;$(document).on('click',btnSelector,function(e){e.preventDefault();var $this=$(this),$product=$this.parents('.product').first(),$content=$('.quick-shop-form'),id=$this.data('product_id'),loadingClass='btn-loading';if($this.hasClass(loadingClass))return;$this.addClass(loadingClass);$product.addClass('loading-quick-shop');$.ajax({url:melawellAjax.ajaxurl,data:{action:'melawell_quick_shop',id:id,},method:'get',success:function(data){$content.html(data);$('html').addClass('quick-shop-shown');initVariationForm($product);},complete:function(){setTimeout(function(){$this.removeClass(loadingClass);$product.removeClass('loading-quick-shop');$body.trigger('melawell-quick-view-displayed');},100);},error:function(){},});}).mouseup(function(e){var $wrap_quick_shop=$('.quick-shop-content');if(!$wrap_quick_shop.is(e.target)&&$wrap_quick_shop.has(e.target).length==0){$('html').removeClass('quick-shop-shown');}}).on('click','.quick-shop-close',function(){$('html').removeClass('quick-shop-shown');}).on('submit','form.cart',function(e){var $productWrapper=$(this).parents('.product');if($productWrapper.hasClass('product-type-external')||$productWrapper.hasClass('product-type-zakeke'))return;e.preventDefault();var form=$(this);form.block({message:null,overlayCSS:{background:'#fff',opacity:0.6}});var formData=new FormData(form[0]);formData.append('add-to-cart',form.find('[name=add-to-cart]').val());formData.delete('woosq-redirect');if(xhr){xhr.abort();}
xhr=$.ajax({url:wc_add_to_cart_params.wc_ajax_url.toString().replace('%%endpoint%%','melawell_add_to_cart'),data:formData,type:'POST',processData:false,contentType:false,complete:function(response){if(wc_add_to_cart_params.cart_redirect_after_add==='yes'){window.location=wc_add_to_cart_params.cart_url;return;}
response=response.responseJSON;if(!response){return;}
if(response.error&&response.product_url){window.location=response.product_url;return;}
var $thisbutton=form.find('.single_add_to_cart_button');$(document.body).trigger('added_to_cart',[response.fragments,response.cart_hash,$thisbutton]);$('.woocommerce-error, .woocommerce-message, .woocommerce-info').remove();$('.single-product .main .woocommerce-notices-wrapper').append(response.fragments.notices_html)
form.unblock();xhr=false;}});});$(document.body).on('added_to_cart',function(){$('html').removeClass('quick-shop-shown');});}
function initVariationForm($product){$product.find('.variations_form').wc_variation_form().find('.variations select:eq(0)').change();$product.find('.variations_form').trigger('wc_variation_form');}
function initSelectShortBy(){let currentValue=$('.melawell-sorting .woocommerce-ordering select option:selected').text();$('.melawell-sorting .woocommerce-ordering label').after('<span class="current-filter">'+currentValue+'</span>');$('#primary').on('change','.melawell-sorting .woocommerce-ordering select',function(){$('.melawell-sorting .woocommerce-ordering .current-filter').text($('option:selected',this).text());});}
function ajax_wishlist_count(){$body.on('woosw_change_count',function(event,count){var counter=$('.header-wishlist .count');counter.html(count);});}
function sendRequest(url){if(xhr){xhr.abort();}
xhr=$.ajax({type:"GET",url:url,beforeSend:function(){var $products=$('ul.melawell-products');if($products.hasClass('products-list')){$products.addClass('preloader');}else{$('>li',$products).html('<div class="skeleton-body"><div class="skeleton-item skeleton-product"></div></div>');}},success:function(data){let $html=$(data);$('#main > ul.melawell-products').replaceWith($html.find('#main > ul.melawell-products'));$('#main > .melawell-woocommerce-pagination').replaceWith($html.find('#main > .melawell-woocommerce-pagination'));$('.woocommerce-result-count').replaceWith($html.find('.woocommerce-result-count'));window.history.pushState(null,null,url);xhr=false;$(document).trigger('skeletonScreen');}});}
function product_archive_layout(){$body.on('click','.gridlist-toggle .list,.gridlist-toggle .grid',function(e){e.preventDefault();if($(this).hasClass('active')){return;}
$(this).siblings().removeClass('active');$(this).addClass('active');var url=$(this).attr('href');sendRequest(url);});$body.on('change','.melawell-products-per-page #per_page',function(e){e.preventDefault();var url=this.value;sendRequest(url);});}
function tooltip(){$body.on('mouseenter','.shop-action .woosq-btn:not(.tooltipstered), .shop-action .woosw-btn:not(.tooltipstered), .shop-action .woosc-btn:not(.tooltipstered), .product-block-list-elementor .add-to-cart-button:not(.tooltipstered), .shop-action a[class*="product_type_"]:not(.tooltipstered)',function(){var $element=$(this);if(typeof $.fn.tooltipster!=='undefined'){$element.tooltipster({position:'left',functionBefore:function(instance,helper){instance.content(instance._$origin.text());},theme:'melawell-product-tooltipster',delay:0,animation:'fade'}).tooltipster('show');}});}
function woo_widget_categories(){var widget=$('.widget_product_categories'),main_ul=widget.find('ul');if(main_ul.length){var dropdown_widget_nav=function(){main_ul.find('li').each(function(){var main=$(this),link=main.find('> a'),ul=main.find('> ul.children');if(ul.length){if(main.hasClass('current-cat-parent')){ul.show();link.before('<i class="melawell-icon-minus"></i>');main.addClass('closed');}else if(main.hasClass('opened')){link.before('<i class="melawell-icon-add"></i>');ul.hide();}else{main.addClass('opened');link.before('<i class="melawell-icon-add"></i>');}
main.find('i').on('click',function(e){ul.slideToggle('slow');if(main.hasClass('closed')){main.removeClass('closed').addClass('opened');main.find('>i').removeClass('melawell-icon-minus').addClass('melawell-icon-add');}else{main.removeClass('opened').addClass('closed');main.find('>i').removeClass('melawell-icon-add').addClass('melawell-icon-minus');}
e.stopImmediatePropagation();});main.on('click',function(e){if($(e.target).filter('a').length)
return;ul.slideToggle('slow');if(main.hasClass('closed')){main.removeClass('closed').addClass('opened');main.find('i').removeClass('melawell-icon-minus').addClass('melawell-icon-add');}else{main.removeClass('opened').addClass('closed');main.find('i').removeClass('melawell-icon-add').addClass('melawell-icon-minus');}
e.stopImmediatePropagation();});}});};dropdown_widget_nav();}}
function quantity(){var $parent=$("li.product");$parent.on("click",".quantity input",function(){return false;});$parent.on("change input",".quantity .qty",function(){var add_to_cart_button=$(this).parents(".product").find(".add_to_cart_button");add_to_cart_button.attr("data-quantity",$(this).val());});$parent.on("keypress",".quantity .qty",function(e){if((e.which||e.keyCode)===13){$(this).parents(".product").find(".add_to_cart_button").trigger("click");}});}
function productHoverRecalc(){$(document).ready(function(){$('.product-block').each(function(i,obj){let heightHideInfo=$('.product-info-bottom',this).outerHeight();$('.content-product-margin',this).css({marginBottom:-heightHideInfo});});});}
$(document).on('woo_widget_categories',woo_widget_categories)
quick_product_variable();ajax_wishlist_count();initSelectShortBy();quantity();productHoverRecalc();$(document).ready(function(){$(document).trigger('woo_widget_categories');}).on('skeletonScreen',function(){productHoverRecalc();});})(jQuery);